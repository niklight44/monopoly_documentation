# Бизнес логика

Теперь перейдем к обработке действий с точки зрения бизнес-логики

1) Запрос на очередность игроков. Логика получает список игроков, возвращает
список с номерами в очереди
2) Проверка на продолжение игры. Логика получает информацию обо всех игроках
(о количестве денег, недвижимости и тд), после чего дает ответ, конец ли игры или нет
3) Нетюремный игрок покупает/продает дом/отель. Логика получает запрос на
определение стоимости Н-улицы, возвращает данные с карточки. Затем логика
получает запрос на покупку с данными игрока и с данными для покупки (количество
домов, улица и тд). Если с данными все хорошо, покупка производится, логика
возвращает положительный ответ на покупку. Если покупка невозможна, логика
возвращает отрицательный ответ.
4) Нетюремный игрок торгуется с другими игроками* (ниже будет пояснялка, что
происходит с точки зрения игроков). В данном случае логика получает данные о
сделке, а возвращает данные, насколько выгодна или невыгодна сама сделка.
5) Нетюремные игрок бросает кубики. Если не выпадает дубль или если
выпадает, для логики ситуация аналогична: она просто получает данные о том, куда
наступил игрок (получает номер позиции), а возвращает данные о том, какой по счету
бросок, с дублем или нет, а также о действии, которое следует на этой позиции:
улица, шанс, казна, стоянка, тюрьма (если выпал третий раз дубль). Если выпала
тюрьма, логика пишет о завершении хода. В остальных случаях ход разрешен. Если
выпадает казна или шанс, возвращает действие для игрока. При покупке улицы идет
следующий шаг
6) Нетюремный игрок и покупка улицы. Логика получает запрос на данные об
улице и возвращает сами данные. Если игрок отказывается от покупки, среди
оставшихся игроков фронт опрашивает, кто участвует в аукционе, и если есть
желающие, данные собираются в адаптере. Участие логики тут не вижу, просто на
уровне адаптера поиск, укого сумма больше. Если игрок соглашается, логика
подтверждает возможность покупки и дает добро адаптеру на снятие суммы. Добро не
дает в том случае, если у игрока не хватает денег. Тогда игроку предлагается
отправить что-то в залог, продать дома или отказаться от покупки.
7) Если выпадал дубль в шаге 5, действия повторяются. Если дубль выпадает в
третий раз, логика оповещает об этом и блокирует игрока ( то есть говорит дааптеру,
что игрок должен быть помечен как тюремный).
8) Ход игрока идет до тех пор, пока действия себя не исчерпают: шаги 5, 3 и 4
9) Тюремный игрок совершает ход. С точки зрения адаптера в рамках комнаты он
будет помечен как тюремный, поэтому логике будут поступать другие запрос ына
обработку. У тюремного игрока есть вариант сразу оплатить штраф или же попытаться
выкинуть дубль. Логика получает запрос на бросок кубиков и выдает ответ.

В целом, это основные действия на уровне логики, где по факту все сводится к задача
“запрос-ответ”. Поскольку адаптер и бизнес-логика являются основными
компонентами в рамках задачи, часть обработки берет на себя адаптер (иначе все
было бы слишком просто). Но всегда первым шагом на уровне логики будет получить
json-файл и понять, что требуется сделать, а дальше отправлять на обработку тому
или иному методу.
Очередь будет называться как “games_logic”, предусматривается синхронный ответ
(нужно посмотреть, как реализовывать синхронность, чтобы избежать костылей. Если
будет сложность, стоит заранее это обговорить с автором тз).
Я бы на месте разработчика вынесла конфиги для очереди на прием и ответ
отдельно, а алгоритмы (в заивисмости от ситуации) – отдельно. Также я вынесла еще
классы-словари. Если они будут храниться в памяти, это не страшно – нагрузка будет
минимальной за счет того, что логика не запоминает, за каким игроком что закреплено,
эту миссию берет на себья адаптер и база данных.

::: info Информация
Торг – это когда игрок 1 предлагает игроку 2 купить или продать улицу, либо же
обменяться карточками. В первом случае игрок 2 соглашается или нет. Во втором у
игрока 2 должен высветиться анализ того, насколько сделка выгодна. Если невыгодна,
игра может порекомендовать отказаться от сделки либо же перейти в денежный
эквивалент. Если выгодна, написать, почему.
::: 